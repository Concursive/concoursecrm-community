<config>
  <hooks>
    <hook class="com.darkhorseventures.cfsbase.Ticket">
      <actions>
        <action type="update" process="dhv.ticket.insert" enabled="true"/>
        <action type="insert" process="dhv.ticket.insert" enabled="true"/>
      </actions>
    </hook>
    <hook class="com.darkhorseventures.cfsbase.Opportunity"/>
    <hook class="com.zeroio.iteam.base.Assignment">
      <actions>
        <action type="insert" process="dhv.assignment.insert" enabled="false"/>
      </actions>
    </hook>
    <hook class="com.darkhorseventures.cfsbase.CustomFieldCategory">
      <actions>
        <action type="insert" process="vport.accountFolder.insert" enabled="true"/>
      </actions>
    </hook>
  </hooks>
  
  <processes>
    <process name="dhv.ticket.insert" description="DHV Ticket alert" startId="1" entered="" modified="">
      <parameters>
        <parameter name="notification.host" value="mail.darkhorseventures.com" type="java.lang.String" enabled="true"/>
        <parameter name="notification.from" value="cfs-root@darkhorseventures.com"/>
      </parameters>
      <components>
        <component id="1" parent="0" class="com.darkhorseventures.cfs.troubletickets.component.LoadTicketDetails" enabled="true"/>
        <component id="2" parent="1" class="com.darkhorseventures.cfs.troubletickets.component.QueryTicketJustClosed"/>
        <component id="3" parent="2" if="false" class="com.darkhorseventures.cfs.troubletickets.component.QueryTicketJustAssigned"/>
        <component id="4" parent="2" if="true" class="com.darkhorseventures.cfs.component.SendUserNotification">
          <parameters>
            <parameter name="notification.module" value="Tickets"/>
            <parameter name="notification.itemId" value="${this.id}"/>
            <parameter name="notification.itemModified" value="${this.modified}"/>
            <parameter name="notification.userToNotify" value="${this.enteredBy}"/>
            <parameter name="notification.subject">CFS Ticket Closed: ${this.paddedId}</parameter>
<parameter name="notification.body">
The following ticket in CFS has been closed:&#13;
&#13;
--- Ticket Details ---&#13;
&#13;
Ticket # ${this.paddedId}&#13;
Priority: ${ticketPriorityLookup.description}&#13;
Severity: ${ticketSeverityLookup.description}&#13;
Issue: ${this.problem}&#13;
&#13;
Comment: ${this.comment}&#13;
&#13;
Closed by: ${ticketModifiedByContact.nameFirstLast}&#13;
&#13;
Solution: ${this.solution}
</parameter>
          </parameters>
        </component>
        <component id="5" parent="3" if="true" class="com.darkhorseventures.cfs.component.SendUserNotification">
          <parameters>
            <parameter name="notification.module" value="Tickets"/>
            <parameter name="notification.itemId" value="${this.id}"/>
            <parameter name="notification.itemModified" value="${this.modified}"/>
            <parameter name="notification.userToNotify" value="${this.enteredBy}"/>
            <parameter name="notification.subject">CFS Ticket Assigned: ${this.paddedId}</parameter>
<parameter name="notification.body">
The following ticket in CFS has been assigned to you:&#13;
&#13;
--- Ticket Details ---&#13;
&#13;
Ticket # ${this.paddedId}&#13;
Priority: ${ticketPriorityLookup.description}&#13;
Severity: ${ticketSeverityLookup.description}&#13;
Issue: ${this.problem}&#13;
&#13;
Assigned By: ${ticketModifiedByContact.nameFirstLast}&#13;
Comment: ${this.comment}
</parameter>
          </parameters>
        </component>
        <component id="6" parent="1" class="com.darkhorseventures.cfs.troubletickets.component.SendTicketToBPM" enabled="false">
          <parameters>
            <parameter name="bpm.host.url" value="http://ds21.darkhorseventures.com:8080/Horse/servlet/ProcessInitiateServlet"/>
          </parameters>
        </component>
        <component id="7" parent="2" if="true" class="com.darkhorseventures.cfs.troubletickets.component.SendTicketSurvey" enabled="true"/>
      </components>
    </process>
    
    <process name="dhv.assignment.insert" description="DHV Assignment alert" startId="100">
      <parameter name="notification.host" value="mail.darkhorseventures.com" type="java.lang.String" enabled="true"/>
      <parameter name="notification.from" value="cfs-root@darkhorseventures.com"/>
      <components>
        <component id="100" parent="0" class="com.darkhorseventures.cfs.projectmanager.component.LoadAssignmentDetails" enabled="true"/>
        <component id="101" parent="100" if="true" class="com.darkhorseventures.cfs.projectmanager.component.QueryAssignmentJustCreated"/>
        <component id="102" parent="101" if="true" class="com.darkhorseventures.cfs.component.SendUserNotification">
          <parameters>
            <parameter name="notification.module" value="Projects"/>
            <parameter name="notification.itemId" value="${this.id}"/>
            <parameter name="notification.itemModified" value="${this.modified}"/>
            <parameter name="notification.userToNotify" value="${this.userAssignedId}"/>
            <parameter name="notification.subject">CFS Activity assigned for project ${project.title}</parameter>
<parameter name="notification.body">
The following activity was assigned to you in CFS:&#13;
&#13;
--- Activity Details ---&#13;
&#13;
Project Name: ${project.title}&#13;
Requirement Name: ${requirement.shortDescription}&#13;
Activity: ${this.role}&#13;
Due Date: ${this.dueDateString}&#13;
Assigned By: ${assignmentAssignedByContact.nameFirstLast}&#13;
</parameter>
          </parameters>
        </component>
      </components>
    </process>
    
    <process name="vport.accountFolder.insert" description="VPort Account Field notification" startId="200">
      <parameter name="notification.host" value="151.204.140.140" enabled="true"/>
      <parameter name="notification.port" value="44444"/>
      <components>
        <component id="200" parent="0" class="com.darkhorseventures.cfs.component.QueryObjectJustInserted" enabled="true"/>
        <component id="201" parent="200" if="true" class="com.darkhorseventures.cfs.folders.component.QueryHasFolderField" enabled="true">
          <parameters>
            <parameter name="customFieldCategory.fieldId" value="11"/>
          </parameters>
        </component>
        <component id="202" parent="201" if="true" class="com.darkhorseventures.cfs.component.SendSSLNotification">
          <parameters>
<parameter name="notification.body">
&lt;?xml version=&quot;1.0&quot; standalone=&quot;yes&quot;?&gt;
&lt;!-- The only field you will be editing is instructions --&gt;
&lt;!-- The max field length of instructions is 216 --&gt;
&lt;tas&gt;
   &lt;tsPacket&gt;
      &lt;transactionId&gt;13&lt;/transactionId&gt;
      &lt;status&gt;0&lt;/status&gt;
      &lt;callId&gt;0&lt;/callId&gt;
      &lt;teamId&gt;3&lt;/teamId&gt;
      &lt;opId&gt;547&lt;/opId&gt;
      &lt;data&gt;
         &lt;psId&gt;289&lt;/psId&gt;
         &lt;specialInstr&gt;
            &lt;instructionId&gt;0&lt;/instructionId&gt;
            &lt;dayOfWeek&gt;&lt;/dayOfWeek&gt;
            &lt;instructions&gt;${this.fieldValue(11):xml}&lt;/instructions&gt;
            &lt;status&gt;T&lt;/status&gt;
            &lt;effective&gt;&lt;/effective&gt;
            &lt;expires&gt;&lt;/expires&gt;
            &lt;inactive&gt;N&lt;/inactive&gt;
            &lt;opName&gt;&lt;/opName&gt;
         &lt;/specialInstr&gt;
      &lt;/data&gt;
   &lt;/tsPacket&gt;
&lt;/tas&gt;
</parameter>
          </parameters>
        </component>
      </components>
    </process>
  </processes>
</config>
