#!/bin/sh

#############################################################################
#
# Configuration
#
#############################################################################
ENVFILE="scripts/env.`hostname`.sh"
PROGNAME=`basename $0`
BASE=`pwd`
WEBUSER="apache"
CFSGROUP="cfs"
CFSDBA="cfsdba"
SITEHOME="/home"
SITECODE=""

usage ()
{
	printf "\nUsage: ${PROGNAME} site_code\n\n"
	printf "Where:\n"
	printf "    site_code       is the target directory under ${SITEHOME}\n"
	printf "\n"
	exit 1
}

#############################################################################
#
# Check that user is root.
#
#############################################################################
if [ "`id -u`" != "0" ] ; then echo "Sorry, you must be root." ; exit 1 ; fi

#############################################################################
#
# Set up environment.
#
#############################################################################
if [ ! -f "${ENVFILE}" ] ; then echo "Missing file: ${ENVFILE}" ; exit ; fi
. ${ENVFILE}

#############################################################################
#
# Get command-line parameters.
#
#############################################################################
if [ -n "$1" ] ; then SITECODE="$1"; shift ; fi
if [ -z "${SITECODE}" ] ; then echo "Missing site code" ; usage ; fi

#############################################################################
#
# Configuration using supplied parameters.
#
#############################################################################
DIRDST="${SITEHOME}/${SITECODE}"
DB="cdb_${SITECODE}"

#############################################################################
#
# Begin install
#
#############################################################################
LOG="${PROGNAME}_${SITECODE}.log"

echo `date` >${LOG}

(
#############################################################################
#
# Verify directories
#
#############################################################################
if [ ! -d "$DIRDST" ] ; then
	if [ ! -d "$DIRDST" ] ; then echo "Exiting..."; exit 1; fi
fi


#############################################################################
#
#############################################################################
echo ok

rm -f ${DIRDST}/html/index.jsp

ant -DSITECODE=${SITECODE} lib
##/home/${SITECODE}/bin/restart 


) >>${LOG} 2>&1 

exit 0


